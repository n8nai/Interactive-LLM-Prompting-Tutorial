<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn to Prompt with Jen</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-mono {
            font-family: 'Roboto Mono', monospace;
        }
        .chat-bubble-user {
            background-color: #3B82F6; /* blue-500 */
            color: white;
        }
        .chat-bubble-ai {
            background-color: #E5E7EB; /* gray-200 */
            color: #1F2937; /* gray-800 */
        }
        .lesson-active {
            background-color: #DBEAFE; /* blue-100 */
            color: #1E40AF; /* blue-800 */
            font-weight: 600;
        }
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        /* Modal styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-container {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar - Lesson Plan -->
        <aside class="w-full md:w-1/4 lg:w-1/5 bg-white p-6 border-r border-gray-200 flex-shrink-0">
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Learn Prompting</h1>
            <p class="text-sm text-gray-500 mb-6">Your interactive guide to mastering LLMs.</p>
            <h2 class="text-lg font-semibold mb-4 text-gray-800">Lesson Plan</h2>
            <ul id="lesson-plan" class="space-y-2">
                <li id="lesson-1" class="p-3 rounded-lg lesson-active">Lesson 1: The Basics of a Prompt</li>
                <li id="lesson-2" class="p-3 rounded-lg text-gray-600">Lesson 2: Adding Context</li>
                <li id="lesson-3" class="p-3 rounded-lg text-gray-600">Lesson 3: Setting a Persona</li>
                <li id="lesson-4" class="p-3 rounded-lg text-gray-600">Lesson 4: Iteration & Refinement</li>
                <li id="lesson-5" class="p-3 rounded-lg text-gray-600">Lesson 5: Advanced Techniques</li>
            </ul>
        </aside>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col bg-gray-50 h-full">
            <header class="bg-white p-4 border-b border-gray-200 shadow-sm flex items-center">
                <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-xl mr-3">J</div>
                <div>
                    <h2 class="text-xl font-bold text-gray-900">Jen, your AI Guide</h2>
                    <p class="text-sm text-green-500 flex items-center">
                        <span class="w-2 h-2 bg-green-500 rounded-full mr-1.5"></span>
                        Online
                    </p>
                </div>
            </header>

            <div id="chat-history" class="flex-1 p-6 overflow-y-auto"></div>
            
            <div id="typing-indicator" class="px-6 pb-2 hidden">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center font-bold text-gray-500 text-lg">J</div>
                    <div class="flex items-center space-x-1">
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0s;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></span>
                        <span class="w-2 h-2 bg-gray-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></span>
                    </div>
                </div>
            </div>

            <div class="p-4 bg-white border-t border-gray-200">
                <div class="relative">
                    <input type="text" id="message-input" class="w-full pl-4 pr-20 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow" placeholder="Click a suggestion above to continue..." disabled>
                    <button id="send-button" class="absolute right-2 top-1/2 -translate-y-1/2 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-5 rounded-full transition-colors disabled:bg-blue-300 disabled:cursor-not-allowed" disabled>
                        Send
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- ✨ Prompt Analyzer Modal -->
    <div id="analyzer-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
        <div class="modal-container bg-white rounded-xl shadow-2xl w-full max-w-2xl transform scale-95">
            <div class="flex justify-between items-center p-5 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">✨ Prompt Analyzer</h3>
                <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600">&times;</button>
            </div>
            <div class="p-6">
                <div id="analyzer-content">
                    <div id="analyzer-loading">
                        <p class="text-gray-600 mb-4">Analyzing your prompt with Gemini...</p>
                        <div class="space-y-3">
                           <div class="h-4 bg-gray-200 rounded-full w-3/4 animate-pulse"></div>
                           <div class="h-4 bg-gray-200 rounded-full w-1/2 animate-pulse"></div>
                           <div class="h-4 bg-gray-200 rounded-full w-5/6 animate-pulse"></div>
                        </div>
                    </div>
                    <div id="analyzer-result" class="hidden"></div>
                </div>
            </div>
        </div>
    </div>


    <script>
        // DOM Elements
        const chatHistoryEl = document.getElementById('chat-history');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const typingIndicator = document.getElementById('typing-indicator');
        const lessonPlanItems = document.querySelectorAll('#lesson-plan li');
        const analyzerModal = document.getElementById('analyzer-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const analyzerLoading = document.getElementById('analyzer-loading');
        const analyzerResult = document.getElementById('analyzer-result');

        // AI System Prompts
        const jenSystemPrompt = `You are an expert AI guide and teacher named "Jen." Your primary goal is to teach me, a new user who may have special needs (e.g., on the spectrum), how to effectively use a Large Language Model (LLM).

        Your teaching style is critical:
        1.  **Extremely Gentle and Encouraging:** Always be positive, patient, and warm. Use simple, direct, and clear language. Praise effort and correct answers enthusiastically (e.g., "That's exactly right! Great job!").
        2.  **Predictable and Structured:** Follow the lesson plan strictly. Always announce when a lesson is starting or ending.
        3.  **Guided Practice (Mandatory):** After you ask a question or give a task, you MUST provide exactly three suggested answers for the user to choose from. This reduces pressure. Format them at the very end of your message like this, with no text after it:
            SUGGESTED_ANSWERS:
            1. [First answer choice]
            2. [Second answer choice]
            3. [Third answer choice]
        4.  **Gentle Progression:** When the user completes a task by selecting an answer, confirm they did well, briefly explain why it was a good choice, and then gently move to the next part of the lesson or the next lesson.

        Lesson Plan:
        - Lesson 1: The Basics of a Prompt.
        - Lesson 2: Adding Context.
        - Lesson 3: Setting a Persona.
        - Lesson 4: Iteration and Refinement.
        - Lesson 5: Advanced Techniques.

        **Your first action:**
        Introduce yourself as Jen, warmly state our goal, and then begin Lesson 1 by asking what a "prompt" is. Provide three simple, clickable options for the answer. Example options: "Instructions for the AI", "A question I ask", "A computer command".`;
        
        const analyzerSystemPrompt = `As a world-class prompt engineering coach, analyze the following prompt written by a new learner. Provide your feedback in two sections. First, an "Analysis" section with a concise, encouraging critique (mention one thing they did well and one area for improvement). Second, a "Suggested Rewrite" section with an improved version of their prompt. Use Markdown for formatting (e.g., **Analysis:**, **Suggested Rewrite:**).`;

        let conversationHistory = [];
        
        const apiKey = "%%GEMINI_API_KEY%%";

        /**
         * Appends a message and suggestion buttons to the chat UI.
         */
        function appendMessage(sender, message) {
            const messageWrapper = document.createElement('div');
            messageWrapper.classList.add('flex', 'flex-col', 'mb-4', 'max-w-2xl', 'items-start');
            
            let mainMessage = message;
            let suggestions = [];

            if (sender === 'ai' && message.includes('SUGGESTED_ANSWERS:')) {
                const parts = message.split('SUGGESTED_ANSWERS:');
                mainMessage = parts[0].trim();
                const suggestionsText = parts[1].trim();
                suggestions = suggestionsText.split('\n').map(line => line.replace(/^\d+\.\s*/, '').trim()).filter(line => line);
            }
            
            const messageContentWrapper = document.createElement('div');
            messageContentWrapper.classList.add('flex', 'items-start', 'w-full');
            
            if (sender === 'user') {
                 messageContentWrapper.classList.add('justify-end', 'ml-auto');
            } else {
                 messageContentWrapper.classList.add('justify-start', 'mr-auto');
            }
            
            let bubbleContent;
            if (sender === 'ai') {
                bubbleContent = `
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg mr-3 flex-shrink-0">J</div>
                    <div class="chat-bubble-ai p-4 rounded-lg shadow-sm">
                        <p>${mainMessage.replace(/\n/g, '<br>')}</p>
                    </div>
                `;
            } else { // User message
                 bubbleContent = `
                    <div class="chat-bubble-user p-4 rounded-lg shadow-sm">
                        <p>${message}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center font-bold text-gray-700 text-lg ml-3 flex-shrink-0">You</div>
                `;
            }

            messageContentWrapper.innerHTML = bubbleContent;
            messageWrapper.appendChild(messageContentWrapper);
            
            if (suggestions.length > 0) {
                const suggestionsContainer = document.createElement('div');
                suggestionsContainer.classList.add('flex', 'flex-wrap', 'gap-2', 'mt-3', 'w-full', 'justify-start', 'pl-11');
                suggestions.forEach(suggestion => {
                    const button = document.createElement('button');
                    button.textContent = suggestion;
                    button.classList.add('suggestion-btn', 'bg-white', 'text-blue-600', 'font-semibold', 'py-2', 'px-4', 'border', 'border-blue-500', 'rounded-full', 'hover:bg-blue-50', 'transition-colors', 'text-sm');
                    button.onclick = () => handleSuggestionClick(suggestion);
                    suggestionsContainer.appendChild(button);
                });
                messageWrapper.appendChild(suggestionsContainer);
            }
            
            chatHistoryEl.appendChild(messageWrapper);
            chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
        }
        
        /**
         * Handles the click on a suggestion button.
         */
        async function handleSuggestionClick(suggestionText) {
            document.querySelectorAll('.suggestion-btn').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed', 'hover:bg-white');
                btn.classList.remove('hover:bg-blue-50');
            });

            appendMessage('user', suggestionText);
            conversationHistory.push({ role: "user", parts: [{ text: suggestionText }] });
            await getJenResponse();
        }

        async function callGemini(contents) {
            if (apiKey.startsWith("%%")) {
                 console.error("API Key has not been replaced. Please configure your GitHub Action secret.");
                 return "It looks like the API key is missing. If you're the developer, please make sure the GitHub Action secret is set up correctly.";
            }
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents })
                });
                const result = await response.json();
                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    return result.candidates[0].content.parts[0].text;
                }
                console.error("API response error:", result);
                return "Sorry, I had a little trouble thinking. Could you try asking again?";
            } catch (error) {
                console.error('Error fetching from Gemini API:', error);
                return 'I seem to be having connection issues. Please check the console for errors.';
            }
        }
        
        async function getJenResponse() {
            typingIndicator.classList.remove('hidden');
            
            const payload = [
                { role: "user", parts: [{ text: jenSystemPrompt }] },
                ...conversationHistory
            ];
            
            // For the very first message, we add a model preamble.
            if (conversationHistory.length === 0) {
                 payload.splice(1, 0, { role: "model", parts: [{ text: "Understood. I am Jen. I will now begin the lesson in a gentle, guided manner." }] });
            }
            
            const jenMessage = await callGemini(payload);

            conversationHistory.push({ role: "model", parts: [{ text: jenMessage }] });
            appendMessage('ai', jenMessage);
            updateLessonTracker(jenMessage);

            typingIndicator.classList.add('hidden');
        }

        async function handleSendMessage() {
            // This function is now effectively disabled in favor of suggestion clicks.
            // We'll leave it for potential future use or manual override.
        }

        function updateLessonTracker(aiResponse) {
            for (let i = 1; i <= 5; i++) {
                if (aiResponse.toLowerCase().includes(`lesson ${i}`)) {
                    lessonPlanItems.forEach(item => item.classList.remove('lesson-active'));
                    const activeLessonEl = document.getElementById(`lesson-${i}`);
                    if(activeLessonEl) activeLessonEl.classList.add('lesson-active');
                }
            }
        }
        
        function closeModal() {
            analyzerModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // --- Event Listeners ---
        sendButton.addEventListener('click', handleSendMessage);
        closeModalBtn.addEventListener('click', closeModal);
        analyzerModal.addEventListener('click', (e) => {
            if (e.target === analyzerModal) closeModal();
        });
        
        // Initial greeting from Jen
        window.addEventListener('load', () => {
            // Start the conversation by getting the first message from the AI
            getJenResponse();
        });
    </script>
</body>
</html>
